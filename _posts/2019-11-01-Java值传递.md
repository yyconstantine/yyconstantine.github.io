---
layout:     post
title:      Java值传递
subtitle:   面试高频的Java值传递分析
date:       2019-11-01
author:     yyconstantine
header-img: img/post-bg-universe.jpg
catalog: true
tags:
    - Java基础
---

### Java值传递

> 面试中一个常见的问题是：
>
> ```java
> public static void add(int n) {
>     n += 10;
> }
> 
> public static void main(String[] args) {
>     int n = 10;
>     add(n);
>     System.out.println(n);
> }
> ```
>
> 请问n值为多少？

首先明确一个概念，即**Java总是按值调用**，也就是说，方法得到的是所有参数值的一个拷贝，特别是，方法不能修改传递给它的任何参数变量的内容。

我们还是拿上面的结果举例，由于其得到的是n的值的拷贝，所以在```add(int n)```方法内操作的不是n本身，而是n的一个拷贝，对拷贝的值的操作不会对main方法中的n产生任何影响，所以n仍然为10，输出结果验证了我们的推论：

```java
Before add: 10
After add: 10
```

以上是Java的值传递，即传递一个基本数据类型，那么传递一个对象呢？

```java
/**
* 定义一个对象
*/
@Data
@AllArgsConstructor
@NoArgsConstructor
class Person {
    String name;
    int age;
}

public static void changeObject(Person person) {
    person = new Person();
}

public static void main(String[] args) {
    Person person = new Person("yyc", 198);
    System.out.println(person.toString());
    changeObject(person);
    System.out.println(person.toString());
}
```

输出结果为：

```java
Person{name='yyc', age=198}
Person{name='yyc', age=198}
```

可以发现，在```changeObject```方法中，```person = new Person();```并未对main方法中的```person```产生影响。

由上面的结论我们可知，在```changeObject```中我们传递的是```person```的值的拷贝，这里由于其是一个对象，则传递的是对象引用的拷贝。在```person```刚传入```changeObject```方法时，```person```本身及其拷贝都指向的是同一个引用地址，但由于```person = new Person();```这一步操作，将方法中引用的拷贝指向了另外的内存地址，则对形参```person```的操作不会对原main方法中的```person```产生影响了，因为他们操作的是不同的引用👇

![引用变更示意](https://i.loli.net/2019/11/01/A2PKfWyFMI3XahN.png)

那么，如果在```changeObject```方法中不变更```person```的拷贝的引用地址，直接操作```person```会产生什么样的结果呢？

```java
public static void changeObject(Person person) {
    person.setName("Boom");
}
```

结果👇：

```java
Person{name='yyc', age=198}
Person{name='Boom', age=198}
```

由于引用未发生变更，所以形参```person```对引用的操作生效，影响了main方法中的```person```对象。

---

#### 总结

- 首先，Java中只存在值传递，不存在引用传递
- 当传入形参为基本数据类型时，方法中数据值的变更不影响调用方法的值
- 当传入形参为对象时（自定义对象、基本数据类型的包装类），如果不改变其引用，对其属性的操作会影响调用方法的对象属性；如果改变其引用，则操作不同的引用对象，不影响调用方法的对象